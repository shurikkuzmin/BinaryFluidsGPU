\documentclass[mathpazo,sort,numbers]{cicp}
\usepackage{bm}
\usepackage{graphicx}
\usepackage{color}
%\usepackage[sort]{cite}
%\usepackage[sort&compress,authoryear,round]{natbib}

%%%%% author macros %%%%%%%%%
% place your own macros HERE
%%%%% end %%%%%%%%%

\begin{document}
%%%%% title : short title may not be used but TITLE is required.
% \title{TITLE}
% \title[short title]{TITLE}
\title{Efficient GPU implementation of multicomponent and multiphase Lattice Boltzmann models.}

%%%%% author(s) :
% single author:
% \author[name in running head]{AUTHOR\corrauth}
% [name in running head] is NOT OPTIONAL, it is a MUST.
% Use \corrauth to indicate the corresponding author.
% Use \email to provide email address of author.
% \footnote and \thanks are not used in the heading section.
% Another acknowlegments/support of grants, state in Acknowledgments section
% \section*{Acknowledgments}
\author[M.~Januszewski and A.~Kuzmin]{M.~Januszewski\affil{1}\corrauth and A.~Kuzmin\affil{2}}
\address{\affilnum{1}\ Institute of Physics, University of Silesia, 40-007 Katowice, Poland\\
\affilnum{2}\ Department of Mechanical and Manufacturing Engineering,
Schulich School of Engineering,
University of Calgary, 2500 University Drive NW ,Calgary, Alberta, T2N 1N4 Canada
}
\emails{{\tt michalj@gmail.com} (M.~Januszewski),{\tt shurik.kuzmin@gmail.com} (A.~Kuzmin)}

% multiple authors:
% Note the use of \affil and \affilnum to link names and addresses.
% The author for correspondence is marked by \corrauth.
% use \emails to provide email addresses of authors
% e.g. below example has 3 authors, first author is also the corresponding
%      author, author 1 and 3 having the same address.
% \author[Zhang Z R et.~al.]{Zhengru Zhang\affil{1}\comma\corrauth,
%       Author Chan\affil{2}, and Author Zhao\affil{1}}
% \address{\affilnum{1}\ School of Mathematical Sciences,
%          Beijing Normal University,
%          Beijing 100875, P.R. China. \\
%           \affilnum{2}\ Department of Mathematics,
%           Hong Kong Baptist University, Hong Kong SAR}
% \emails{{\tt zhang@email} (Z.~Zhang), {\tt chan@email} (A.~Chan),
%          {\tt zhao@email} (A.~Zhao)}
% \footnote and \thanks are not used in the heading section.
% Another acknowlegments/support of grants, state in Acknowledgments section
% \section*{Acknowledgments}


%%%%% Begin Abstract %%%%%%%%%%%
\begin{abstract}
Graphics Processing Units (GPUs) have been succesfully used to simulate
various systems using the Lattice Boltzmann (LB) method.  The simulations were
usually either a straightforward port of a CPU code (without any
regards to performance considerations), or optimized for single phase
flows.  The implementation of more complicated problems such as
multiphase models or models with Nearest-Neighbours (NN) interaction
has never received any special attention.  The purpose of this paper
is twofold: to illustrate the usefulness of GPUs for multiphase simulations,
and to carefully develop an optimized and efficient algorithm for GPU
simulations of fluid flows using LB models with NN terms.
\end{abstract}
%%%%% end %%%%%%%%%%%

%%%%% AMS/PACs/Keywords %%%%%%%%%%%
%\pac{}

\ams{52B10, 65D18, 68U05, 68U07{\color{red} We need to find somewhere classifications.}}
\keywords{Lattice Boltzmann method, GPU, Shan-Chen model, Free-energy model, binary liquids, multiphase flow, CUDA, OpenCL, GPGPU}

%%%% maketitle %%%%%
\maketitle


%%%% Start %%%%%%
\section{Introduction}
\label{sec:introduction}
During the last two decades since the lattice Boltzmann method was introduced \cite{mcnamara}, the method became mature to compete with the well established computational fluid dynamics (CFD). Due to the kinetic nature of the method the method is applicable to simulate not only hydrodynamics but also thermal flows \cite{karlin-minimalmodels,yuan-thermal}, micro-flows \cite{ansumali-small-knudsen}, ferrofluids \cite{rosensweig,kuzmin-aniso}, multiphase flows \cite{rothman-color,Shan-chen:extended,swift}. In the presence of complex physical effects such as turbulence, multi-phase flows, flow of oil and gas through porous material, flow around surfaces with complex geometries, or blood flow with deformable particles, the solution of the basic Navier-Stokes equations becomes difficult or impractical. On the other hand, the micro-scale calculations for such systems based on the  Molecular Dynamics approach (MD) are computationally extremely demanding.  The Lattice Boltzmann Method (LBM), which focuses on the meso-scale, may be the best choice for such complex flow problems, being able to capture macro- and micro-flows.

{\color{red} Michal, please add here more details.}
The lattice Boltzmann method is the explicit numerical method opposing some restrictions on the time propagation step. Thus the physical time step corresponding to the numerical time step is relatively small. Performing large-time-scale simulations become unpractical due to the high computational demand. To overcome the problem of the high computational demand the physical problems are calculated with the help of parallel processors of a cluster. The recent years trend is to perform the simulations on Graphical Processing Units (GPUs) which can be viewed as small supercomputers due to the large number of independent threads performing a simulation. The attractive part of simulations on GPUs is the low price (in comparison with clusters) and large performance. Not all the problems are matched to be simulated on parallel machines. However, the lattice Boltzmann method is a perfect match for parallel structure machines as GPUs. 

During the last years the method was applied for many different problems, such as, to name a few, the calculation of the drag coefficient for the two-dimensional flow through cylinders \cite{tolke-twod} and moving sphere in three-dimensional channel \cite{tolke-GPU}. To the authors' best knowledge only simple hydrodynamics problems GPUs implementation is thoroughly described in the literature. However, the nearest neighbours (NN) interaction which includes advanced boundary lattice Boltzmann methods and multiphase problems are still not covered. For many multiphase problems the local density gradient is required to properly simulate the physics. The implementation of the multiphase models are more challenging than simple hydrodynamics problems because of the additional information required from other nodes. The simple hydrodynamics lattice Boltzmann method is local and is perfectly parallelized. The NN problems requires the additional information from other nodes and can't be addressed as local any more. 

This work's aim is to present the efficient GPUs algorithms to implement the binary liquids models based on the free-energy approach and the Shan-Chen method. First, we thoroughly describe the GPUs algorithms. Then the Shan-Chen model and the free-energy binary liquid model lattice Boltzmann implementation is presented. The numerical results for the comparison benchmark between those two models is done in terms of performance and accuracy in the ``Numerical results`` section. We conclude the paper with the main findings.

\section{LBM}
\label{sec:lbm:binary:liquids}
This works concentrates on two popular LBM multiphase models. Originally introduced in 1993 \cite{Shan-chen:extended} the model attracted a multitude of researchers by its simplicity.  The free-energy model \cite{swift} is based on the free-energy phase transition \cite{landau}. Both models werre successfully applied in simulation of two-phase blood flow \cite{halliday-multicomponent}, flow in microchannels \cite{pooley-contact}, thermal flow \cite{zhang-thermal}, and studies of break-up of the liquid droplet \cite{nourgaliev-breakup}. The section describes the two-dimensional implementation of the Shan-Chen and free-energy models with the D2Q9 model.

\subsection{Shan-Chen model}
In the Shan-Chen model \cite{Shan-chen:extended} the force at a given node depends on all local neighbours characteristics:
\begin{equation}  \label{Shan-Chen:Shan-Chen:cont}
\bm{F}(\bm{x})=-G\psi(\rho(\bm{x}))\sum_{i}{w_i \psi(\rho(\bm{x}+\bm{c_i}))\bm{c_{i}}},
\end{equation}
where $\psi$ is the function of local characteristics of a node, and taken as $\psi(\rho)=1-\exp(-\rho)$. Coefficient $G$ is responsible for the attraction force between the molecules. Overall, the Shan-Chen force is the approximation of the force between molecules \cite{kwok,kwok-contact-angle}. The force modifies the momentum fluxes as:
\begin{equation*}
P_{\alpha\beta}=\biggl(c_s^2\rho+\frac{G}{6}\psi^2+\frac{G}{36}%
|\bm{\nabla}\psi|^2 +\frac{G}{18}\psi\Delta\psi\biggr)\delta_{\alpha\beta}-\frac{G}{%
18}\partial_{\alpha}\psi\partial_{\beta}\psi,
\end{equation*}
where the equation of states is changed from original $P=c_s^2 \rho$ \cite{Succi-book} to the van-der-Waals type equation of state:
\begin{equation} 
P=c_s^2 \rho +\frac{G}{6} \psi(\rho)^2.
\end{equation}

{\color{red} Michal, you can add here binary Shan-Chen model. You have more information on it than me.}

\subsection{Binary liquid multiphase model}
In this section we'd like to describe binary liquid model. Binary model is based on the free energy model \cite{swift,landau}:
\begin{equation}
\mathfrak{F}=\int{J \mathrm{d}V}=\int{\left(c_s^2\rho\ln\rho+\frac{A}{2}\phi^2+\frac{B}{4}\phi^4 + \frac{k}{2}(\nabla \phi)^2 \right)\mathrm{d}V},
\end{equation}
where coefficients $A$ and $B$ are responsible for the phase separation, coefficient $k$ is responsible for the surface tension between phases and $\phi$ is the order parameter. Different phases are corresponding to extreme values of $\phi$ as $-1$ and $1$.
The lattice Boltzmann model for the binary free-energy model is defined through two distribution sets:
\begin{equation}
\begin{aligned}
&f_i^{eq}=w_i \rho \biggl(1+\frac{u_{\alpha}c_{i\alpha}}{c_s^2}+\frac{Q_{i\alpha\beta}u_{\alpha}u_{\beta}}{2 c_s^4}\biggr), i=0\div8\\
&g_i^{eq}=w_i(\Gamma \mu + \frac{\phi c_{i\alpha} u_{i\alpha}}{c_s^2}+\phi^m \frac{Q_{i\alpha\beta}u_{\alpha}u_{\beta}}{2 c_s^4}), i\neq0 \\
&g_0^{eq}=\phi-\sum_{i\neq0}{g_i^{eq}}\quad,
\end{aligned}
\end{equation}
where $\Gamma$ is the mobility parameter, chemical potential $\mu=-A\phi+A\phi^3-k\Delta\phi$, $k$ is related to the surface tension. The macroscopic parameters are calculated as:
\begin{equation}
\begin{aligned}
\rho=\sum_i{f_i}\\
\rho u_{\alpha}=\sum_i{f_i c_{i\alpha}}\\
\phi=\sum_i{g_i}
\end{aligned}
\end{equation}
The equilibrium distribution functions lead to the macroscopic equations {\color{red} Give citation here}:
\begin{equation}
\begin{aligned}
&\partial_t \rho+ \partial_{\alpha} \rho u_{\alpha}=0\\
&\rho\left(\partial_t+u_{\beta}\partial_{\beta}\right) u_{\alpha}=\\
&-\partial_{\alpha}P_{\alpha \beta} + \nu\partial_{\beta}\left(\partial_{\alpha}u_{\beta}+\partial_{\beta} u_{\alpha} + \frac{1}{3}\partial_{\gamma} u_{\gamma} \delta_{\alpha\beta}\right)\\
&\partial_t \phi + \partial_{\alpha} \phi u_{\alpha}=D\Delta \mu,
\end{aligned}
\label{binary:fluid:system}
\end{equation}
with the bulk pressure $p_0=\rho c_s^2-\frac{B}{2}\phi^2+\frac{3}{4}B \phi^2$.

{\color{red} Michal, need your help here. Which parameters have you used for simulation. Please check above.}
We take equilibrium distribution function for the binary-liquid gas model. In general, it can be presented in the following form:
\subsection{Lattice Boltzmann implementation}
For all distribution functions the collision and streaming step are performed:
\begin{equation*}
\begin{aligned}
f_i^{\star}=(1-\omega)f_i+f_i^{eq}\\
f_i(\bm{x}+\bm{c_i})=f_i^{\star}. 
\end{aligned}
\end{equation*}

\section{GPU implementation}
\section{Results}
\section{Conclusion}
%%%% Acknowledgments %%%%%%%%
\section*{Acknowledgments}
A.~Kuzmin wants to thank the Alberta Ingenuity Fund for their financial support.

%%%% Bibliography  %%%%%%%%%%
\bibliographystyle{plain}
\bibliography{paper}

% \begin{thebibliography}{99}
% \bibitem{Berger}M. J. Berger and P. Collela, Local adaptive mesh refinement
% for shock hydrodynamics,
% J. Comput. Phys., 82 (1989), 62-84.
% \bibitem{deBoor}C. de Boor,  Good Approximation By Splines With Variable Knots II, in Springer Lecture
%  Notes Series 363, Springer-Verlag, Berlin, 1973.
% \bibitem{TanTZ} Z. J. Tan, T. Tang and Z. R. Zhang, A simple moving mesh method for one- and
% two-dimensional phase-field equations, J. Comput. Appl. Math., to appear.
% \bibitem{Toro}E. F. Toro, Riemann Solvers and Numerical Methods for Fluid Dynamics,
% Springer-Verlag Berlin Heidelbert, 1999.
% \end{thebibliography}

\end{document}
